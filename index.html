<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RANKING OFICIAL BATALHA DOS INSCRITOS</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèÜ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bronze: #cd7f32; --prata: #e0e0e0; --ouro: #ffd700;
            --platina: #00ced1; --diamante: #b9f2ff; --mestre: #ff0040;
            --bg-dark: #0a0a10; --glass: rgba(20, 20, 30, 0.85);
            --neon-blue: #00f2ea;
        }

        body { 
            background-color: var(--bg-dark); color: white; 
            font-family: 'Rajdhani', sans-serif; margin: 0; padding: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 242, 234, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 90% 80%, rgba(255, 0, 64, 0.15) 0%, transparent 50%);
            background-attachment: fixed; min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        h1, h2, h3 { font-family: 'Black Ops One', cursive; text-transform: uppercase; margin: 0; letter-spacing: 1px; }
        .text-gold { color: var(--ouro); text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        .text-blue { color: var(--neon-blue); text-shadow: 0 0 10px rgba(0, 242, 234, 0.5); }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }

        /* --- HEADER --- */
        .header-hero {
            text-align: center; padding: 30px 15px; position: relative;
            background: linear-gradient(180deg, rgba(0,0,0,0.4) 0%, rgba(0, 242, 234, 0.05) 100%);
            border-bottom: 1px solid #333;
        }
        .header-hero h1 { font-size: 2.5rem; line-height: 1.1; background: linear-gradient(to right, #fff, #00f2ea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .last-update { font-size: 0.85rem; color: #888; margin-top: 5px; font-weight: bold; }

        .btn-jogo {
            position: absolute; top: 20px; right: 20px;
            text-decoration: none; color: var(--neon-blue);
            border: 1px solid var(--neon-blue); padding: 8px 20px; border-radius: 30px;
            font-weight: bold; font-family: 'Rajdhani'; text-transform: uppercase;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            transition: all 0.2s; z-index: 100;
        }
        .btn-jogo:active { transform: scale(0.95); background: var(--neon-blue); color: black; }

        .season-wrapper {
            max-width: 600px; margin: 20px auto 0;
            background: rgba(0,0,0,0.5); border: 1px solid #333; border-radius: 20px; padding: 12px;
        }
        .season-info { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; color: #ccc; font-weight: bold; }
        .progress-track { width: 100%; height: 8px; background: #222; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--neon-blue), var(--mestre)); width: 0%; transition: width 1s; }

        /* --- √ÅREA DE AN√öNCIOS (ADSTERRA) --- */
        .ad-container {
            width: 100%;
            display: flex; justify-content: center; align-items: center;
            padding: 10px; margin: 10px 0;
            background: rgba(0, 0, 0, 0.2);
            border: 1px dashed rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden; /* Protege o layout no celular */
            min-height: 110px; /* Altura m√≠nima para o banner de 90px */
        }
        
        .ad-container:hover { border-color: rgba(255, 255, 255, 0.2); }

        /* --- GRID --- */
        .dashboard-grid { display: grid; grid-template-columns: 320px 1fr 300px; gap: 20px; }
        .glass-card {
            background: var(--glass); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.08); border-radius: 12px;
            padding: 15px; display: flex; flex-direction: column; gap: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        .card-header { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 0; display: flex; align-items: center; gap: 10px; }
        .card-icon { font-size: 18px; }

        .patentes-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 8px; text-align: center; }
        .patente-card { background: rgba(255,255,255,0.03); padding: 8px; border-radius: 8px; border: 1px solid #333; display: flex; flex-direction: column; align-items: center; }
        .p-shield { width: 35px; height: 35px; margin-bottom: 2px; filter: drop-shadow(0 0 5px currentColor); }
        .p-info small { color: #888; font-size: 9px; display: block; }
        .p-info strong { font-size: 12px; display: block; }

        .top-list { display: flex; flex-direction: column; gap: 6px; max-height: 350px; overflow-y: auto; }
        .top-item { display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; }
        .top-rank { font-weight: 900; font-size: 16px; width: 20px; text-align: center; color: #555; }
        .top-item:nth-child(1) .top-rank { color: #ffd700; }
        .top-item:nth-child(2) .top-rank { color: #c0c0c0; }
        .top-item:nth-child(3) .top-rank { color: #cd7f32; }
        .top-avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 1px solid #444; }
        .top-info { flex-grow: 1; line-height: 1.1; }
        .top-name { font-weight: bold; font-size: 13px; color: #eee; }
        .top-value { font-size: 11px; font-weight: bold; }

        .search-input { width: 100%; padding: 12px; background: #151520; border: 1px solid #444; color: white; border-radius: 8px; font-family: 'Rajdhani'; font-size: 16px; box-sizing: border-box; -webkit-appearance: none; }
        .general-table-wrapper { max-height: 600px; overflow-y: auto; border-radius: 8px; background: #111; border: 1px solid #333; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #1a1a25; color: #aaa; padding: 10px; text-align: left; position: sticky; top: 0; z-index: 2; font-size: 11px; }
        td { padding: 8px 10px; border-bottom: 1px solid #222; font-size: 14px; }
        .player-cell { display: flex; align-items: center; gap: 8px; }
        .table-avatar { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; }
        .rank-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 6px; border-radius: 4px; background: rgba(0,0,0,0.5); border: 1px solid #333; font-size: 10px; font-weight: bold; white-space: nowrap; }
        .rank-badge svg { width: 12px; height: 12px; }

        @media (max-width: 1100px) {
            .dashboard-grid { grid-template-columns: 1fr; } 
            .dashboard-grid > div:nth-child(1) { order: 1; }
            .dashboard-grid > div:nth-child(2) { order: 2; }
            .dashboard-grid > div:nth-child(3) { order: 3; }
        }
        @media (max-width: 600px) {
            .container { padding: 10px; gap: 15px; }
            .header-hero { padding: 20px 10px; }
            .header-hero h1 { font-size: 2rem; margin-top: 10px; }
            .btn-jogo { position: relative; top: auto; right: auto; display: block; width: 100%; text-align: center; margin-bottom: 15px; padding: 12px; font-size: 1.1rem; }
            .glass-card { padding: 12px; gap: 10px; }
            th, td { padding: 8px 5px; }
            .rank-badge { font-size: 9px; padding: 1px 4px; }
            .table-avatar { width: 24px; height: 24px; }
            th:nth-child(1), td:nth-child(1) { width: 30px; text-align: center; } 
            th:nth-child(4), td:nth-child(4) { text-align: right; }
        }
    </style>
</head>
<body>

    <div class="header-hero">
        <a href="https://jstech-dot.github.io/batalha-dos-inscritos/#" target="_blank" class="btn-jogo">
            üéÆ JOGAR AGORA
        </a>

        <h1 class="text-blue">RANKING DAS LIVES BATALHA DOS INSCRITOS</h1>
        <h3 style="color:white; font-size:0.9rem; letter-spacing:3px; opacity:0.7;">RANKING OFICIAL</h3>
        <div class="last-update" id="last-update">...</div>
        
        <div class="season-wrapper">
            <div class="season-info">
                <span>üìÖ TEMPORADA</span>
                <span id="season-days-left">...</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="season-bar" style="width: 0%"></div>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:10px; color:#666;">
                <span id="season-start-date">-</span>
                <span id="season-end-date">-</span>
            </div>
        </div>
    </div>

    <div class="container">
        
        <div class="ad-container">
            <script>
                atOptions = {
                    'key' : 'c4610708d1a1c2a5116993c3e68efb88',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
            </script>
            <script src="https://www.highperformanceformat.com/c4610708d1a1c2a5116993c3e68efb88/invoke.js"></script>
        </div>
        <div class="glass-card" style="border-top: 2px solid var(--neon-blue);">
            <div class="card-header"><span class="card-icon">üõ°Ô∏è</span><h3>GUIA DE PATENTES</h3></div>
            <div class="patentes-grid" id="patentes-guide"></div>
        </div>

        <div class="ad-container">
            <script>
                atOptions = {
                    'key' : 'c4610708d1a1c2a5116993c3e68efb88',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
            </script>
            <script src="https://www.highperformanceformat.com/c4610708d1a1c2a5116993c3e68efb88/invoke.js"></script>
        </div>
        <div class="dashboard-grid">
            
            <div style="display:flex; flex-direction:column; gap:15px;">
                <div class="glass-card" style="border-top: 2px solid var(--ouro);">
                    <div class="card-header"><span class="card-icon">üëë</span><h3>HALL DA FAMA</h3></div>
                    <div class="top-list" id="hall-fama-list"></div>
                </div>
                <div class="glass-card" style="border-top: 2px solid #00ff00;">
                    <div class="card-header"><span class="card-icon">üíé</span><h3>MAGNATAS</h3></div>
                    <div class="top-list" id="magnatas-list"></div>
                </div>
            </div>

            <div class="glass-card" style="border-top: 2px solid white;">
                <div class="card-header"><span class="card-icon">üìä</span><h3>CLASSIFICA√á√ÉO</h3></div>
                <input type="text" id="searchInput" class="search-input" placeholder="üîç Buscar jogador..." onkeyup="filtrarTabela()">
                <div class="general-table-wrapper">
                    <table id="playersTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>JOGADOR</th>
                                <th>PATENTE</th>
                                <th>PTS</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; gap:15px;">
                <div class="glass-card">
                    <div class="card-header"><span class="card-icon">üìà</span><h3>ESTAT√çSTICAS</h3></div>
                    <canvas id="rankChart" style="max-height:220px;"></canvas>
                </div>
                <div class="glass-card">
                    <div class="card-header"><span class="card-icon">‚ÑπÔ∏è</span><h3>INFO</h3></div>
                    <p style="font-size:12px; color:#aaa; line-height:1.5;">
                        Ranking atualizado diariamente ap√≥s a live.<br>
                        Jogue no TikTok para subir de elo!
                    </p>
                </div>
            </div>

        </div>

        <div class="ad-container" style="margin-top: 20px;">
            <script>
                atOptions = {
                    'key' : 'c4610708d1a1c2a5116993c3e68efb88',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
            </script>
            <script src="https://www.highperformanceformat.com/c4610708d1a1c2a5116993c3e68efb88/invoke.js"></script>
        </div>
        </div>

    <script>
        const PATENTES_CONFIG = [
            { nome: 'LENDA', min: 10000, cor: '#a200ff', svg: '<path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z" fill="currentColor"/><path d="M12 4l2 5h5l-4 3 1 5-4-3-4 3 1-5-4-3h5z" fill="white" filter="drop-shadow(0px 0px 2px #ff00ff)"/>' },
            { nome: 'MESTRE', min: 3000, cor: '#ff0040', svg: '<path d="M12 2L2 7v6c0 5.5 3.8 10.7 10 12 6.2-1.3 10-6.5 10-12V7l-10-5z" fill="currentColor"/><path d="M12 6l-2 4H6l3 2.5L7 16l5-3 5 3-2-3.5 3-2.5h-4L12 6z" fill="white"/>' },
            { nome: 'DIAMANTE', min: 2000, cor: '#b9f2ff', svg: '<path d="M12 2L2 7l10 15 10-15-10-5z" fill="currentColor"/><path d="M12 5l-5 3 5 8 5-8-5-3z" fill="#00000050"/>' },
            { nome: 'PLATINA', min: 1600, cor: '#00ced1', svg: '<path d="M12 2L2 7v6c0 5.5 3.8 10.7 10 12 6.2-1.3 10-6.5 10-12V7l-10-5z" fill="currentColor"/><circle cx="12" cy="12" r="4" fill="#ffffff50"/>' },
            { nome: 'OURO', min: 1300, cor: '#ffd700', svg: '<path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z" fill="currentColor"/><path d="M12 4l2 5h5l-4 3 1 5-4-3-4 3 1-5-4-3h5z" fill="#b8860b"/>' },
            { nome: 'PRATA', min: 1100, cor: '#c0c0c0', svg: '<path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z" fill="currentColor"/>' },
            { nome: 'BRONZE', min: 0, cor: '#cd7f32', svg: '<path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z" fill="currentColor"/>' }
        ];

        let todosJogadores = [];

        fetch('dados/dados.json')
            .then(res => { if(!res.ok) throw new Error(); return res.json(); })
            .then(backup => processarDados(backup))
            .catch(err => {
                document.getElementById('last-update').innerHTML = "<span style='color:red'>Erro ao carregar dados</span>";
                console.error(err);
            });

        function processarDados(backup) {
            const safeParse = (str) => { try { return typeof str === 'string' ? JSON.parse(str) : (str || {}); } catch { return {}; } };
            
            const rankedData = safeParse(backup.ranked);
            const winsData = safeParse(backup.wins);
            const fotosData = safeParse(backup.fotos);
            const vipData = safeParse(backup.vipRanking);
            const seasonData = safeParse(backup.season);

            if (backup.data) document.getElementById('last-update').innerText = "ATUALIZADO: " + backup.data;
            atualizarCalendario(seasonData);

            todosJogadores = Object.entries(rankedData).map(([nome, dados]) => {
                const pts = typeof dados === 'number' ? dados : (dados.pontos || 1000);
                return { nome, pontos: pts, foto: tratarFoto(fotosData[nome]), patente: getPatenteInfo(pts) };
            }).sort((a,b) => b.pontos - a.pontos);

            const hallFama = Object.entries(winsData).map(([nome, wins]) => ({
                nome, wins, foto: tratarFoto(fotosData[nome])
            })).sort((a,b) => b.wins - a.wins).slice(0, 10);

            const magnatas = Object.entries(vipData).map(([nome, diamantes]) => ({
                nome, diamantes, foto: tratarFoto(fotosData[nome])
            })).sort((a,b) => b.diamantes - a.diamantes).slice(0, 10);

            renderizarGuiaPatentes();
            renderizarHallFama(hallFama);
            renderizarMagnatas(magnatas);
            renderizarTabela(todosJogadores);
            renderizarGrafico(todosJogadores);
        }

        function atualizarCalendario(seasonData) {
            if (!seasonData || !seasonData.fim) return;
            const inicio = seasonData.inicio || (Date.now() - 1000);
            const fim = seasonData.fim;
            const dataFim = new Date(fim).toLocaleDateString('pt-BR');
            const dataInicio = new Date(inicio).toLocaleDateString('pt-BR');
            document.getElementById('season-start-date').innerText = `IN√çCIO: ${dataInicio}`;
            document.getElementById('season-end-date').innerText = `FIM: ${dataFim}`;

            const updateTimer = () => {
                const now = Date.now();
                const total = fim - inicio;
                const passado = now - inicio;
                const restante = fim - now;
                let pct = (passado / total) * 100;
                pct = Math.max(0, Math.min(100, pct));
                document.getElementById('season-bar').style.width = pct + '%';

                if (restante <= 0) {
                    document.getElementById('season-days-left').innerHTML = "<span style='color:red'>FINALIZADA</span>";
                } else {
                    const dias = Math.floor(restante / (1000 * 60 * 60 * 24));
                    const horas = Math.floor((restante % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    document.getElementById('season-days-left').innerText = `RESTAM: ${dias}d ${horas}h`;
                }
            };
            setInterval(updateTimer, 60000); updateTimer();
        }

        function renderizarGuiaPatentes() {
            document.getElementById('patentes-guide').innerHTML = PATENTES_CONFIG.map(p => `
                <div class="patente-card">
                    <svg class="p-shield" viewBox="0 0 24 24" style="color:${p.cor}">${p.svg}</svg>
                    <div class="p-info"><strong style="color:${p.cor}">${p.nome}</strong><small>${p.min}+ PTS</small></div>
                </div>
            `).join('');
        }

        function renderizarHallFama(lista) {
            const container = document.getElementById('hall-fama-list');
            if(lista.length === 0) { container.innerHTML = '<div style="padding:10px; color:#666; font-size:12px;">Nenhum registro.</div>'; return; }
            container.innerHTML = lista.map((p, i) => `
                <div class="top-item"><div class="top-rank">${i+1}</div><img class="top-avatar" src="${p.foto}"><div class="top-info"><div class="top-name">${p.nome}</div><div class="top-value text-gold">${p.wins} WINS</div></div></div>
            `).join('');
        }

        function renderizarMagnatas(lista) {
            const container = document.getElementById('magnatas-list');
            if(lista.length === 0) { container.innerHTML = '<div style="padding:10px; color:#666; font-size:12px;">Nenhum registro.</div>'; return; }
            container.innerHTML = lista.map((p, i) => `
                <div class="top-item"><div class="top-rank">${i+1}</div><img class="top-avatar" src="${p.foto}"><div class="top-info"><div class="top-name">${p.nome}</div><div class="top-value text-blue">üíé ${p.diamantes}</div></div></div>
            `).join('');
        }

        function renderizarTabela(lista) {
            const tbody = document.querySelector('#playersTable tbody');
            const display = lista.slice(0, 100);
            tbody.innerHTML = display.map((p, i) => `
                <tr>
                    <td><span style="color:#666; font-weight:bold;">${i+1}</span></td>
                    <td><div class="player-cell"><img class="table-avatar" src="${p.foto}" style="border: 1px solid ${p.patente.cor}"><span style="font-weight:bold; color:${p.patente.cor}">${p.nome}</span></div></td>
                    <td><div class="rank-badge" style="color:${p.patente.cor}; border-color:${p.patente.cor}"><svg viewBox="0 0 24 24" fill="currentColor">${p.patente.svg}</svg>${p.patente.nome}</div></td>
                    <td style="font-weight:bold;">${p.pontos}</td>
                </tr>
            `).join('');
        }

        function renderizarGrafico(lista) {
            const counts = {}; PATENTES_CONFIG.forEach(p => counts[p.nome] = 0);
            lista.forEach(p => counts[p.patente.nome]++);
            if(window.myChart) window.myChart.destroy();
            const ctx = document.getElementById('rankChart').getContext('2d');
            window.myChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: PATENTES_CONFIG.map(p => p.nome), datasets: [{ data: PATENTES_CONFIG.map(p => counts[p.nome]), backgroundColor: PATENTES_CONFIG.map(p => p.cor), borderWidth: 0 }] },
                options: { responsive: true, plugins: { legend: { position: 'right', labels: { color: 'white', boxWidth: 10, font: { size: 10 } } } } }
            });
        }

        function getPatenteInfo(pontos) { return PATENTES_CONFIG.find(p => pontos >= p.min) || PATENTES_CONFIG[PATENTES_CONFIG.length - 1]; }
        function tratarFoto(url) { if(!url || url.includes('undefined')) return 'https://p16-va-tiktok.ibyteimg.com/img/musically-maliva-obj/1665282759496710~c5_100x100.jpeg'; return url; }
        function filtrarTabela() { const termo = document.getElementById('searchInput').value.toLowerCase(); const filtrados = todosJogadores.filter(p => p.nome.toLowerCase().includes(termo)); renderizarTabela(filtrados); }
    </script>
</body>
</html>



